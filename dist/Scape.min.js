function Router(){var a=this;this.view="";this.allowInterrupt=true;this.previousHash="";this.routingBegun=function(){};this.routingFinshed=function(){};this.hash="";this.current_page="";this.procedures={}}Router.prototype.route=function(){var a=this.getHash();this.routingBegun(a);if(!this.allowInterrupt){location.hash=this.previousHash;return}this.allowInterrupt=false;console.debug("[NAVIGATION] hash = "+a);if(_.has(this.procedures,a)){this.procedures[a]()}else{console.debug("[SCAPEJS-Router] Could not find procedure for '"+a+"'");this.allowInterrupt=true;location.hash=this.otherwise}this.allowInterrupt=true;this.hash=a;this.routingFinshed(a)};Router.prototype.config=function(a,b){var d=this;this.setView(a);for(var c=b.length-1;c>=0;c--){if(b[c].hasOwnProperty("otherwise")){this.otherwise=b[c].otherwise}else{this.defineProcedure(b[c])}}console.debug(this.procedures)};Router.prototype.clear=function(){this.procedures={}};Router.prototype.enable=function(){var a=this;var b=function(){a.route()};window.addEventListener("hashchange",b,false);b()};Router.prototype.reload=function(){this.route()};Router.prototype.disableRouting=function(){window.addEventListener("hashchange",function(){},false)};Router.prototype.setRouteBegun=function(a){if(_.isFunction(a)){this.routingBegun=a}else{throw"[ROUTER] setRouteBegun only accepts functions as parameter"}};Router.prototype.setRouteFinished=function(a){if(_.isFunction(a)){this.routingFinshed=a}else{throw"[ROUTER] setRouteFinished only accepts functions as parameter"}};Router.prototype.defineProcedure=function(b){var a=this;if(!_.isString(b.tmpl)){throw"[SCAPEJS] Could not define procedure, tmpl attribute is not a valid string!"}if(_.isFunction(b.js)){this.procedures[b.url]=function(){a.loadHTML(b.tmpl,b.js)}}else{if(_.isString(b.js)){this.procedures[b.url]=function(){console.log("loading html");a.loadHTML(b.tmpl,function(){$.getScript(b.js)})}}else{throw"[SCAPEJS] Could not define procedure, link.js is not a function nor a string."}}};Router.prototype.removeProcedure=function(a){delete this.procedures[a]};Router.prototype.clear=function(){this.procedures={}};Router.prototype.setView=function(a){if(_.isString(a)&&$(a).is("div")){this.view=a}else{throw"[SCAPEJS] View selector must be a div"}};Router.prototype.loadHTML=function(a,c){var b=this;$(this.view).animate({opacity:0},500,function(){$(this).empty();$.ajax({url:a,cache:false,success:function(d){$(b.view).html(d);if(_.isFunction(c)){c()}$(b.view).animate({opacity:1},500)},error:function(d){console.debug("Page: "+a+" could not be loaded");console.debug(d)},async:false})})};Router.prototype.getUrlParameter=function(d){var c=location.hash;if(location.hash.indexOf(d)==-1){return""}var e=c.indexOf(d)+d.length+1;var a=c.indexOf("&",e);var b="";if(a!=-1){b=c.substr(e,a-e)}else{b=c.substr(e)}return b};Router.prototype.changeHashParameter=function(e,c){var d=location.hash;if(location.hash.indexOf(e)==-1){return false}var f=d.indexOf(e)+e.length+1;var b=d.indexOf("&",f);var a="";if(b!=-1){a=d.substr(0,f)+c+d.substr(b)}else{a=d.substr(0,f)+c}location.hash=a;return true};Router.prototype.getHash=function(){var b=location.hash;b=b.substr(1);var a=b.indexOf("?");if(a!=-1){b=b.substr(0,a)}return b};function Communicator(){this.default_error_function=function(a){console.debug("[SCAPEJS] AJAX error! \n ");console.debug(a)};this.result="";this.ajax_template={type:"POST",url:undefined,data:undefined,success:undefined,error:this.default_error_function,dataType:"text",cache:false,async:false};this.requests=[]}Communicator.prototype.config=function(a){};Communicator.prototype.format=function(b,a){var c="";if(!_.isUndefined(b)){c="action="+b;if(!_.isUndefined(a)){if(_.isString(a)){c+="&data="+a}else{if(_.isObject(a)){c+="&data="+JSON.stringify(a)}}}}return c};Communicator.prototype.validateResponse=function(a){console.debug(a);if(_.isString(a)){console.debug(/SERVER:/.test(a));if(/SERVER:/.test(a)){a=a.substr(a.indexOf("SERVER:")+"SERVER:".length);a=JSON.parse(a);if(_.has(a,"token")&&_.has(a,"response")){var b=a.response;this.token=a.token;if(/JSON:/.test(b)){b=b.substr(b.indexOf("JSON:")+"JSON:".length)}return b}}}console.warn("[SCAPEJS RESPONSE VALIDATE] Invalid server response");return"FAILURE"};Communicator.prototype.send=function(b,g,e,a,d){var c=this;var f=this.ajax_template;console.debug("[SCAPEJS SEND] "+e);if(_.isUndefined(b)){throw"[ScapeJS Communicator] url missing, aborting HTTP REQUEST.";return}if(!_.isUndefined(g)){f.success=function(h){h=c.validateResponse(h);g(h);c.result=h}}else{throw"[ScapeJS Communicator] url missing, aborting HTTP REQUEST.";return}f.url=b;f.error=(_.isUndefined(a))?f.error:a;f.async=(_.isUndefined(d))?f.async:d;f.data=(_.isUndefined(e))?"":e;$.ajax(f)};Communicator.prototype.request=function(b,f,e,g,a,c){var d=this.format(f,e);this.send(b,g,d,a,c)};"use strict";function Scape(){this.router=new Router();this.communication=new Communicator()};