(function(a){a.fn.extend({limiter:function(b,c){a(this).on("keyup focus",function(){d(this,c)});function d(g,f){var e=g.value.length;if(e>b){g.value=g.value.substr(0,b);e=b}f.html(b-e)}d(a(this)[0],c)}})})(jQuery);String.prototype.contains=function(a,b){if(b){a=a.toLowerCase();this.toLowerCase()}return(this.indexOf(a)!=-1)};Array.prototype.remove=function(){var e,c=arguments,b=c.length,d;while(b&&this.length){e=c[--b];while((d=this.indexOf(e))!==-1){this.splice(d,1)}}return this};function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b}function isEmpty(b){if(!objExists(b)){return true}try{b=b.replace(/[ ]/g,"");if(b==""){return true}return false}catch(a){return false}}function objExists(a){if(typeof a!="undefined"){if(a!=null){return true}return false}return false}function emptySet(a){if(Array.isArray(a)){if(a.length==0){return true}return false}return false}function urlcheck(a){return/^http\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?$/.test(a)}function echeck(b){var c=b;var a=/^[a-zA-Z0-9\-_]+(\.[a-zA-Z0-9\-_]+)*@[a-z0-9]+(\-[a-z0-9]+)*(\.[a-z0-9]+(\-[a-z0-9]+)*)*\.[a-z]{2,4}$/;if(a.test(c)){return true}else{return false}}function includes(a,b){return(a.indexOf(b)!=-1)}function isBlank(a){if(typeof a=="undefined"){return true}var b=a.trim();if(b==""){return true}else{return false}}var getAcrobatInfo=function(){var a=function(){return this.name=this.name||function(){var g=navigator?navigator.userAgent.toLowerCase():"other";if(g.indexOf("chrome")>-1){return"chrome"}else{if(g.indexOf("safari")>-1){return"safari"}else{if(g.indexOf("msie")>-1){return"ie"}else{if(g.indexOf("firefox")>-1){return"firefox"}}}}return g}()};var f=function(g){try{return new ActiveXObject(g)}catch(h){}};var c=function(g){for(key in navigator.plugins){var h=navigator.plugins[key];if(h.name==g){return h}}};var d=function(){return this.plugin=this.plugin||function(){if(a()=="ie"){return f("AcroPDF.PDF")||f("PDF.PdfCtrl")}else{return c("Adobe Acrobat")||c("Chrome PDF Viewer")||c("WebKit built-in PDF")}}()};var e=function(){return !!d()};var b=function(){try{var i=d();if(a()=="ie"){var g=i.GetVersions().split(",");var h=g[0].split("=");return parseFloat(h[1])}if(i.version){return parseInt(i.version)}return i.name}catch(j){return null}};return{browser:a(),acrobatExists:e()?true:false,acrobatVersion:b()}};function changeNavTo(a){$("ul.nav li").each(function(b){$(this).removeClass()});$("ul.nav li a[href^='"+a+"']").parent().addClass("active")};function Generator(){this.factory=[]}Generator.prototype.addFactory=function(b,a){if(typeof a!="function"){return false}this.factory[b]=a;return true};Generator.prototype.manifest=function(a,b){if(objExists(this.factory[a])){return this.factory[a](b)}else{console.debug("[GENERATOR] Could not find factory");return""}};function AjaxCommunicator(){this.default_error_function=function(a){bootbox.alert("Error: Failed to contact server. Refresh page and try again.")};this.result="";this.ajax_template={type:"POST",url:undefined,data:undefined,success:undefined,error:this.default_error_function,dataType:"text",cache:false,async:false};this.requests=[]}AjaxCommunicator.prototype.format=function(b,a){var c="";if(objExists(b)){c="action="+b;if(objExists(a)){if(typeof a=="string"){c+="&data="+a}else{if(typeof a=="object"){c+="&data="+JSON.stringify(a)}}}}return c};AjaxCommunicator.prototype.validateResponse=function(a){console.debug(a);if(objExists(a)&&typeof a=="string"){if(a.contains("SERVER:")){a=a.substr(a.indexOf("SERVER:")+"SERVER:".length);a=JSON.parse(a);if(objExists(a.token)&&objExists(a.response)){if(a.response=="SIGNOUT"){return"SIGNOUT"}if(a.response.indexOf("JSON:")!=-1){a.response=a.response.substr(a.response.indexOf("JSON:")+"JSON:".length)}return a}}}console.debug("invalid server response!");return"FAILURE"};AjaxCommunicator.prototype.send=function(a,g,i,d,c,h,b){var f=this.ajax_template;var e=this;console.log(i);if(!objExists(a)){throw"[AjaxCommunicator] url missing, aborting HTTP REQUEST.";return}if(!objExists(i)){i=""}if(objExists(g)){f.success=function(j){j=e.validateResponse(j);g(j.response,h,b);e.result=j}}else{throw"[AjaxCommunicator] url missing, aborting HTTP REQUEST.";return}if(objExists(d)){f.error=d}if(objExists(c)){f.async=c}f.url=a;f.data=i;$.ajax(f)};AjaxCommunicator.prototype.addRequest=function(e,f,d,a,b){var c=this;if(!objExists(a)||typeof a!="function"){a=function(h,i,g){console.log("[AJAX: "+e+"] = "+h);if(typeof h=="string"){if(h.contains("FAILURE")){if(objExists(g)){g(h)}}else{if(objExists(i)){i(h)}}}}}if(!objExists(d)){d==false}this.requests[e]=function(h,i,g){c.send(f,a,h,b,d,i,g)}};AjaxCommunicator.prototype.request=function(c,b,e,a){if(!objExists(e)){throw"[AjaxCommunicator] All requests need success functions";console.error("[AjaxCommunicator] Could not find request")}if(objExists(this.requests[c])){var d=this.format(c,b);this.requests[c](d,e,a)}else{console.debug("[AjaxCommunicator] Could not find request");throw"[AjaxCommunicator] Could not find request"}};function Constructor(){var b=this;this.current_page="";this.current_param="";this.procedures={};var a=function(c){console.log(c.detail.page);b.setup(c.detail.page)};document.addEventListener("ConstructorSetup",a)}Constructor.prototype.setup=function(a,b){console.log("did you happen too late?");if(this.procedures.hasOwnProperty(a)){this.procedures[a](b);this.current_page=a;this.current_param=b;document.dispatchEvent(evt.maninpulator.presentView);return true}else{console.debug("[CONSTRUCTOR] Could not find procedure '"+a+"'");return false}};Constructor.prototype.addProcedure=function(b,a){this.procedures[b]=a};Constructor.prototype.loadProcedure=function(b,a){this.procedures[b]=function(){var e=$("script[src='"+a+"']");if(e.length>0){src.remove()}var c=$.Deferred(),d=document.createElement("script");d.async="async";d.type="text/javascript";d.src=a+"?a="+(new Date()).getTime();d.onload=d.onreadystatechange=function(g,f){if(!d.readyState||/loaded|complete/.test(d.readyState)){if(f){c.reject()}else{c.resolve()}}};d.onerror=function(){c.reject()};$("head")[0].appendChild(d)}};Constructor.prototype.removeProcedure=function(a){delete this.procedures[a]};Constructor.prototype.clear=function(){this.procedures=[]};function ContentManipulator(){var c=this;this.view_target="";var a=function(f){c.clearView()};var d=function(f){console.log("testing");c.presentView()};var b=function(f){c.setTargetDivAjax(f.detail.page,f.detail.funct)};document.addEventListener("clearView",a);document.addEventListener("presentView",d);document.addEventListener("setTargetDivAjax",b)}ContentManipulator.prototype.setView=function(a){if(objExists(a)&&typeof a=="string"&&$(a).is("div")){this.view_target=a;return true}else{return false}};ContentManipulator.prototype.clearView=function(){$(this.view_target).animate({opacity:0},500,function(){$(this).empty()})};ContentManipulator.prototype.presentView=function(){console.log("did you happen too early?");$(this.view_target).animate({opacity:1},500)};ContentManipulator.prototype.viewSwap=function(a,b){$(a).fadeOut(500);$(b).fadeOut(500,function(){$(a).css({display:"none"});$(b).fadeIn(500)})};ContentManipulator.prototype.setContentDivAjax=function(a,b,c){$(a).animate({opacity:0},500,function(){$.ajax({url:b,cache:false,success:function(d){$(parent.view_target).html(d);if(objExists(c)){c()}},error:function(d){bootbox.alert("Error: "+d)},async:false})})};ContentManipulator.prototype.setTargetDivAjax=function(a,c){var b=this;$(this.view_target).animate({opacity:0},500,function(){$.ajax({url:a,cache:false,success:function(d){$(b.view_target).html(d);if(objExists(c)){c()}},error:function(d){bootbox.alert("Page: "+a+" could not be loaded");console.debug(d)},async:false})})};ContentManipulator.prototype.setModularDivAjax=function(a,c){var b=this;$(this.view_target).animate({opacity:0},500,function(){$.ajax({type:"GET",data:"url="+a,url:"server-side/transciever/localizer.php",cache:false,success:function(d){$(b.view_target).html(d);if(objExists(c)){c()}},error:function(d){bootbox.alert("Error: "+d)},async:false})})};ContentManipulator.prototype.swapContentDiv=function(a,b,c){$(a).fadeOut(500,function(){$(a).html($(b).html());$(a).fadeIn(500,function(){if(objExists(c)){c()}})})};ContentManipulator.prototype.setContentDiv=function(a,b){$(a).fadeOut(500,function(){$(a).html(b);$(a).fadeIn(500)})};ContentManipulator.prototype.updateContentDiv=function(b,d){var c,a;$(b).fadeOut(500,function(){c=d.innerHTML;c=c.replace("&amp;","&");a=document.getElementsByName(c+"");a=a[0].innerHTML;c=c.replace("&","&amp;");$(b).html("<strong class='title'>"+c+"</strong><br><br>"+a);$(b).fadeIn(500)})};ContentManipulator.prototype.setFormField=function(a,b){$(a).html($(b).html())};function Storage(){return{cache:{dummy:"",profile:{privilege:"client"},},addData:function(a,b){this.cache[a]=b},get:function(a){if(this.cache.hasOwnProperty(a)){return this.cache[a]}console.error("[STORAGE] key: '"+a+"' does not exist.");return undefined},set:function(a,b){if(!this.cache.hasOwnProperty(a)){console.error("[STORAGE] key: '"+a+"' does not exist.");return false}this.cache[a]=b;return true},clear:function(){this.cache={dummy:"",profile:{privilege:"client"},}}}};function Router(){var a=this;this.allowInterrupt=true;this.previousHash="";this.routes=[];this.currentHash=""}Router.prototype.route=function(){var a=this.getHash();if(!this.allowInterrupt){location.hash=this.previous_hash;return}this.allowInterrupt=false;console.debug("[NAVIGATION] hash = "+a);if(objExists(this.routes[""+a])){this.routes[a]();this.previousHash=a}else{console.debug("[NAVIGATION] Could not find route: '"+a+"'")}this.allowInterrupt=true;this.currentHash=a};Router.prototype.addRoute=function(b,d,a){var c=this;this.routes[b]=function(){document.dispatchEvent(evt.maninpulator.clearView);var e=function(){console.log("wrapper? anyone?");if(objExists(a)){a()}else{evt.constructor.setup.detail.page=c.currentHash;console.log(evt.constructor.setup.detail.page);document.dispatchEvent(evt.constructor.setup)}allowInterrupt=true};evt.maninpulator.setTargetDivAjax.detail.page=d;evt.maninpulator.setTargetDivAjax.detail.funct=e;document.dispatchEvent(evt.maninpulator.setTargetDivAjax)}};Router.prototype.removeRoute=function(a){delete this.routes[a]};Router.prototype.clear=function(){this.keys=[]};Router.prototype.enableRouting=function(){var a=this;var b=function(){a.route()};window.addEventListener("hashchange",b,false);b()};Router.prototype.reload=function(){this.route()};Router.prototype.disableRouting=function(){window.addEventListener("hashchange",function(){},false)};Router.prototype.getUrlParameter=function(d){var c=location.hash;if(location.hash.indexOf(d)==-1){return""}var e=c.indexOf(d)+d.length+1;var a=c.indexOf("&",e);var b="";if(a!=-1){b=c.substr(e,a-e)}else{b=c.substr(e)}return b};Router.prototype.changeHashParameter=function(e,c){var d=location.hash;if(location.hash.indexOf(e)==-1){return false}var f=d.indexOf(e)+e.length+1;var b=d.indexOf("&",f);var a="";if(b!=-1){a=d.substr(0,f)+c+d.substr(b)}else{a=d.substr(0,f)+c}location.hash=a;return true};Router.prototype.getHash=function(){var b=location.hash;b=b.substr(1);var a=b.indexOf("?");if(a!=-1){b=b.substr(0,a)}return b};var evt={constructor:{setup:new CustomEvent("ConstructorSetup",{bubbles:false,cancelable:true,detail:{page:undefined,}})},maninpulator:{clearView:new CustomEvent("clearView",{bubbles:false,cancelable:true,}),presentView:new CustomEvent("presentView",{bubbles:false,cancelable:true,}),setTargetDivAjax:new CustomEvent("setTargetDivAjax",{bubbles:false,cancelable:true,detail:{page:undefined,funct:undefined,}})}};function Scape(){this.generator=new Generator();this.communicator=new AjaxCommunicator();this.constructor=new Constructor();this.maninpulator=new ContentManipulator();this.storage=new Storage();this.router=new Router()};